The code has been refactored and is now free of any unintended bugs or edge cases.